# ğŸ‰ Smart Word Definition Popup v1.2.1

**Release Date:** 2025-10-11

## ğŸ”§ Critical Fix: Dark Theme Contrast Issues

This release fixes the major issue where the popup would have poor contrast on dark-themed websites like Bluesky, Twitter/X, and Reddit, making text unreadable.

## âœ¨ What's New

### Enhanced Background Detection
- ğŸ¨ **Deeper DOM traversal** (20 levels instead of 10) for better color detection
- ğŸŒ— **Handles semi-transparent overlays** and complex layouts
- ğŸ¯ **Prioritizes solid colors** for more accurate theming
- ğŸ”„ **Improved fallback chain**: element â†’ body â†’ html â†’ system preference

### WCAG AA Compliance
- âœ… **Automatic contrast checking** using WCAG 2.1 standards
- ğŸ“Š **Guarantees 4.5:1 minimum contrast ratio** for normal text
- ğŸ”§ **Auto-corrects text color** if contrast is insufficient
- ğŸ‘ï¸ **Ensures readability** in all scenarios

### Better Color Support
- ğŸ¨ Now handles **rgba() colors** with alpha channel
- ğŸ” Improved detection of **overlapping transparent elements**
- ğŸ’¡ More robust **color extraction** from computed styles

### Debugging
- ğŸ› Added **console logs** for theme detection troubleshooting
- ğŸ“ Shows **detected vs adjusted colors**

## ğŸŒŸ Tested & Working On

- âœ… GitHub (light & dark)
- âœ… Twitter/X (light & dark) 
- âœ… Reddit (light & dark)
- âœ… **Bluesky (dark)** â† Fixed!
- âœ… Medium
- âœ… Stack Overflow
- âœ… Wikipedia
- âœ… News sites
- âœ… Documentation sites

## ğŸ“¦ Installation

### New Users
1. Install [Tampermonkey](https://www.tampermonkey.net/) or [Violentmonkey](https://violentmonkey.github.io/)
2. Click on `word-definition-popup.user.js` below
3. Click "Install" when prompted
4. Start selecting words on any webpage!

### Existing Users
Your userscript manager should auto-update within 24 hours. To update manually:
1. Open your userscript manager dashboard
2. Find "Smart Word Definition Popup"
3. Click "Check for updates"

## ğŸ”„ Upgrade Notes

- âœ… **No breaking changes** - seamless upgrade from v1.2.0 or earlier
- âœ… **Settings preserved** - all customizations remain intact
- âœ… **Immediate effect** - new contrast algorithm applies right away

## ğŸ“‹ Full Feature List

- ğŸ¯ Instant word definitions on text selection
- ğŸ¨ Adaptive theming matching website colors
- âœ… WCAG AA compliant contrast (4.5:1 minimum)
- ğŸ­ Smart positioning with viewport detection
- âŒ¨ï¸ IBM Plex Mono typography
- ğŸª¶ Lightweight and fast (~10KB)
- ğŸŒ Works on all websites
- ğŸ†“ No API key required
- ğŸ”’ No tracking or data collection

## ğŸ› Bug Fixes

- Fixed white popup background on dark websites (Bluesky, Twitter/X dark mode, Reddit dark mode)
- Fixed poor text contrast in complex layouts
- Fixed color detection on sites with transparent overlays
- Fixed fallback to system color scheme preference

## ğŸ“š Documentation

- ğŸ“– [Full README](https://github.com/doniwicaksono/word-definition-popup/blob/main/README.md)
- ğŸš€ [Installation Guide](https://github.com/doniwicaksono/word-definition-popup/blob/main/INSTALLATION.md)
- ğŸ”§ [Configuration Options](https://github.com/doniwicaksono/word-definition-popup/blob/main/README.md#%EF%B8%8F-configuration)

## ğŸ™ Acknowledgments

Thanks to users who reported the contrast issues on dark-themed websites! Your feedback made this release possible.

## ğŸ“ Changelog

**Full Changelog**: https://github.com/doniwicaksono/word-definition-popup/compare/v1.2.0...v1.2.1

### Changed
- Enhanced `getSmartBackgroundColor()` with deeper traversal
- Added `getContrastRatio()` for WCAG compliance checking
- Added `ensureContrast()` for automatic text color correction
- Improved `parseColor()` to handle rgba with alpha channel
- Updated `applyTheme()` with contrast verification
- Increased `maxDepth` from 10 to 20 in background detection

### Added
- Debug logging for theme detection
- Alpha channel support in color parsing
- System preference fallback (`prefers-color-scheme`)
- Contrast ratio calculation using WCAG formula

---

**Download the script below and enjoy better readability everywhere! ğŸ“šâœ¨
# 🎉 Smart Word Definition Popup v1.2.1

**Release Date:** 2025-10-11

## 🔧 Critical Fix: Dark Theme Contrast Issues

This release fixes the major issue where the popup would have poor contrast on dark-themed websites like Bluesky, Twitter/X, and Reddit, making text unreadable.

## ✨ What's New

### Enhanced Background Detection
- 🎨 **Deeper DOM traversal** (20 levels instead of 10) for better color detection
- 🌗 **Handles semi-transparent overlays** and complex layouts
- 🎯 **Prioritizes solid colors** for more accurate theming
- 🔄 **Improved fallback chain**: element → body → html → system preference

### WCAG AA Compliance
- ✅ **Automatic contrast checking** using WCAG 2.1 standards
- 📊 **Guarantees 4.5:1 minimum contrast ratio** for normal text
- 🔧 **Auto-corrects text color** if contrast is insufficient
- 👁️ **Ensures readability** in all scenarios

### Better Color Support
- 🎨 Now handles **rgba() colors** with alpha channel
- 🔍 Improved detection of **overlapping transparent elements**
- 💡 More robust **color extraction** from computed styles

### Debugging
- 🐛 Added **console logs** for theme detection troubleshooting
- 📝 Shows **detected vs adjusted colors**

## 🌟 Tested & Working On

- ✅ GitHub (light & dark)
- ✅ Twitter/X (light & dark) 
- ✅ Reddit (light & dark)
- ✅ **Bluesky (dark)** ← Fixed!
- ✅ Medium
- ✅ Stack Overflow
- ✅ Wikipedia
- ✅ News sites
- ✅ Documentation sites

## 📦 Installation

### New Users
1. Install [Tampermonkey](https://www.tampermonkey.net/) or [Violentmonkey](https://violentmonkey.github.io/)
2. Click on `word-definition-popup.user.js` below
3. Click "Install" when prompted
4. Start selecting words on any webpage!

### Existing Users
Your userscript manager should auto-update within 24 hours. To update manually:
1. Open your userscript manager dashboard
2. Find "Smart Word Definition Popup"
3. Click "Check for updates"

## 🔄 Upgrade Notes

- ✅ **No breaking changes** - seamless upgrade from v1.2.0 or earlier
- ✅ **Settings preserved** - all customizations remain intact
- ✅ **Immediate effect** - new contrast algorithm applies right away

## 📋 Full Feature List

- 🎯 Instant word definitions on text selection
- 🎨 Adaptive theming matching website colors
- ✅ WCAG AA compliant contrast (4.5:1 minimum)
- 🎭 Smart positioning with viewport detection
- ⌨️ IBM Plex Mono typography
- 🪶 Lightweight and fast (~10KB)
- 🌐 Works on all websites
- 🆓 No API key required
- 🔒 No tracking or data collection

## 🐛 Bug Fixes

- Fixed white popup background on dark websites (Bluesky, Twitter/X dark mode, Reddit dark mode)
- Fixed poor text contrast in complex layouts
- Fixed color detection on sites with transparent overlays
- Fixed fallback to system color scheme preference

## 📚 Documentation

- 📖 [Full README](https://github.com/doniwicaksono/word-definition-popup/blob/main/README.md)
- 🚀 [Installation Guide](https://github.com/doniwicaksono/word-definition-popup/blob/main/INSTALLATION.md)
- 🔧 [Configuration Options](https://github.com/doniwicaksono/word-definition-popup/blob/main/README.md#%EF%B8%8F-configuration)

## 🙏 Acknowledgments

Thanks to users who reported the contrast issues on dark-themed websites! Your feedback made this release possible.

## 📝 Changelog

**Full Changelog**: https://github.com/doniwicaksono/word-definition-popup/compare/v1.2.0...v1.2.1

### Changed
- Enhanced `getSmartBackgroundColor()` with deeper traversal
- Added `getContrastRatio()` for WCAG compliance checking
- Added `ensureContrast()` for automatic text color correction
- Improved `parseColor()` to handle rgba with alpha channel
- Updated `applyTheme()` with contrast verification
- Increased `maxDepth` from 10 to 20 in background detection

### Added
- Debug logging for theme detection
- Alpha channel support in color parsing
- System preference fallback (`prefers-color-scheme`)
- Contrast ratio calculation using WCAG formula

---

**Download the script below and enjoy better readability everywhere! 📚✨